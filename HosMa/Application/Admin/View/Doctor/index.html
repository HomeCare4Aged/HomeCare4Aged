<include file="Index/header" />
<div id="wrapper">
	<include file="Index/nav" />
	<div id="page-wrapper">
		<div class="container-fluid">
			<div class="row">
				<div class="col-md-12">
					<ol class="breadcrumb">
						<li class="">
							<i class="fa fa-fw fa-edit"></i>
							医生信息
						</li>
						
					</ol>
				</div>				
			</div><!--.row面包屑导航   -->
			<div class="row xx-div-search">
				<!--<div class="col-md-6">
					<form action="__ACTION__" method="get" class="form-horizontal">
						<div class="input-group">
							<span class="input-group-addon">搜索</span>
								<input type="text" name="keywords" class="form-control" id="xx-input-article-search" placeholder="请输入搜索条件" />
							<span class="input-group-btn">
								<button type="submit" class="btn btn-primary">
									<span class="glyphicon glyphicon-search"></span>
								</button>
							</span>
						</div>
					</form>
				</div>-->
				<div class="col-sm-2">
					<button class="btn btn-primary " data-toggle="modal" data-target="#myModal">
					 新增医生
				</button>
				</div>
				<!-- 按钮触发模态框 -->
				<!--<button class="btn btn-primary" data-toggle="modal" data-target="#Modal">
					 弹框修改
				</button>-->
			</div>
			<div class="row">
				<div class="col-sm-12">
					<div class="table-responsive">
						<form id="xx-form-list">
							<table class="table table-bordered table-hover xx-table-list">
								<thead>
									<tr>
										<td style="display: none;"></td>
										<td>医生姓名</td>
										<td>照片</td>
										<td>所属科室</td>
										<td>职称</td>
										<td>简介</td>
										<td>联系方式</td>
										<td style="display: none;"></td>
										<td style="display: none;"></td>
										<td style="display: none;"></td>
										<td colspan="2">操作</td>
									</tr>
								</thead>
								<tbody>
									<volist name="doctors" id="vo">
										<tr>
											<td style="display: none;">{$vo.hospital_doctor_id}</td>
											<td>{$vo.hospital_doctor_name}</td>
											<td>{$vo.hospital_doctor_picture}</td>
											<td>{$vo.hospital_office_name}</td>
											<td>{$vo.identity_name}</td>
											<td>{$vo.hospital_doctor_introduction}</td>
											<td>{$vo.hospital_doctor_phone}</td>
											<td style="display: none;">{$vo.hospital_office_id}</td>
											<td style="display: none;">{$vo.hospital_doctor_identity}</td>
											<td style="display: none;">{$vo.hospital_doctor_sex}</td>
											<td>
												<span class="glyphicon glyphicon-edit" id="xx-span-edit1" attr-id="" data-toggle="modal"  onclick="editClick(this)">编辑</span>
											</td>
											<td>
												<span class="glyphicon glyphicon-trash" id="xx-span-delete" attr-id="{$vo.hospital_doctor_id}">删除</span>
											</td>
									</volist>
								</tbody>
							</table>
						</form>
						<nav>
							<ul class="pagination">
								{$pageRes}
							</ul>
						</nav><!--分页控件-->
					</div>
				</div>	
			</div><!--row-->
			<div class="col-sm-10">
				<!-- 模态框（Modal） -->
				<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="ture">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
								&times;
								</button>
								<h4 class="modal-title" id="myModalLabel">
									新增医生信息
								</h4>
							</div>
							<div class="modal-body">
								<div class="row">
									<div class="col-sm-10 col-sm-offset-1">
										<form id="xx-form-add" class="form-horizontal">
											<div class="form-group">
												<label for="xx-input-hospital-doctor-name-add" class="control-label col-sm-3">医生姓名：</label>
												<div class="col-sm-5">
													<input id="xx-input-hospital-doctor-name-add" class="form-control" type="text" 
													name="hospital_doctor_name" placeholder="请输入医生姓名" />
												</div>
												<div class="col-sm-4">
													<p class="xx-p-validate-result" attr-validate="hospital_doctor_name"></p>
												</div>
											</div>
											<div class="form-group">
												<label for="xx-input-hospital-doctor-identity" class="control-label col-sm-3">医生职称：</label>
												<div class="col-sm-5">
													<!--<input id="xx-input-hospital-doctor-identity" class="form-control" type="text" 
													name="identity_name" placeholder="请输入医生职称" />-->
													<select class="form-control" name="identity_name" id="xx-input-hospital-doctor-identity">
														<volist name="userindentity" id="vo">
															<option value="">{$vo.identity_name}</option>
														</volist>
													</select>
												</div>
												<div class="col-sm-4">
													<p class="xx-p-validate-result" attr-validate="identity_name"></p>
												</div>
											</div>
											<div class="form-group">
												<label for="xx-input-hospital-office-id" class="control-label col-sm-3">科室名称：</label>
												<div class="col-sm-5">
													<select class="form-control" name="hospital_office_name" id="selectedKESHI">
														<volist name="useroffices" id="vo">
															<option value="">{$vo.hospital_office_name}</option>
														</volist>
													</select>
												</div>
												<div class="col-sm-4">
													<p class="xx-p-validate-result" attr-validate="hospital_office_id"></p>
												</div>
											</div>
											<div class="form-group">
												<label for="xx-input-hospital-doctor-introduction" class="control-label col-sm-3">医生简介：</label>
												<div class="col-sm-5">
													<textarea class="js-editor" id="xx-textarea-hospital-doctor-introduction" name="hospital_doctor_introduction" rows="5" placeholder="请输入内容"></textarea>
												</div>
												<div class="col-sm-4">
													<p class="xx-p-validate-result" attr-validate="hospital_doctor_introduction"></p>
												</div>
											</div>
											<div class="form-group">
												<label for="xx-input-hospital-doctor-phone" class="control-label col-sm-3">联系方式：</label>
												<div class="col-sm-5">
													<input id="xx-input-hospital-doctor-phone" class="form-control" type="text" 
													name="hospital_doctor_phone" placeholder="请输入联系方式" />
												</div>
												<div class="col-sm-4">
													<p class="xx-p-validate-result" attr-validate="hospital_doctor_phone"></p>
												</div>
											</div>
											<div class="form-group">
												<label for="xx-input-image" class="control-label col-sm-3">医生照片：</label>
												<div class="col-sm-5">
													<input id="xx-input-img-uploader" type="file" />
													<!-- 展示缩略图 -->
													<img src="" alt="" id="xx-img-show-thumb" width="150px" style="display: none;"/>
													<!-- 封面图字段 -->
													<input type="hidden" name="image_path" id="xx-input-image-path"/>
													<!-- 缩略图图字段 -->
													<input type="hidden" name="thumb_path" id="xx-input-thumb-path"/>
												</div>
											</div>
											<div class="form-group">
												<label for="" class="control-label col-sm-3">性别：</label>
												<div class="col-sm-5">
													<input type="radio" name="hospital_doctor_sex" value="男" />男
													<input type="radio" name="hospital_doctor_sex" value="女" />女
												</div>
											</div>
											<div class="form-group">
												<label for="" class="control-label col-sm-3">状态：</label>
												<div class="col-sm-5">
													<input type="radio" name="status" value="1" checked="" />开启
													<input type="radio" name="status" value="0" />关闭
												</div>
											</div>
										</form>
									</div>
								</div><!--.row表单-->
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-default" data-dismiss="modal">
									关闭
								</button>
								<button type="button" class="btn btn-primary" id="xx-btn-add-submit">
									提交更改
								</button>
							</div>
						</div><!-- /.modal-content -->
					</div><!-- /.modal -->
				</div>
			</div>	
			<div class="col-sm-10">
				<!-- 模态框（Modal） -->
				<div class="modal fade" id="Modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="ture">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
								&times;
								</button>
								<h4 class="modal-title" id="myModalLabel">
									修改医生信息
								</h4>
							</div>
							<div class="modal-body">
								<div class="row">
									<div class="col-sm-10 col-sm-offset-1">
										<form id="xx-form-add" class="form-horizontal">
											<div class="form-group">
												<input id="xx-input-doctorid" class="form-control" type="text"name="hospital_doctor_id" style="display: none;"/>
											</div>
											<div class="form-group">
												<input id="xx-input-hospital-office-id-edit" class="form-control" type="text"name="hospital_office_id" style="display: none;"/>
											</div>
											<div class="form-group">
												<input id="xx-input-hospital-doctor-identity-edit" class="form-control" type="text"name="hospital_doctor_identity" style="display: none;"/>
											</div>
											<div class="form-group">
												<label for="xx-input-hospital-doctor-name-edit" class="control-label col-sm-3">医生姓名：</label>
												<div class="col-sm-5">
													<input id="xx-input-hospital-doctor-name-edit" class="form-control" type="text" 
													name="hospital_doctor_name" placeholder="请输入医生姓名" />
												</div>
												<div class="col-sm-4">
													<p class="xx-p-validate-result" attr-validate="hospital_doctor_name"></p>
												</div>
											</div>
											<div class="form-group">
												<label for="xx-input-identity-name-edit" class="control-label col-sm-3">医生职称：</label>
												<div class="col-sm-5">
													<!--<input id="xx-input-identity-name-edit" class="form-control" type="text" 
													name="identity_name" value="{$doctors.hospital_doctor_identity}" placeholder="请输入医生职称" />-->
													<select class="form-control" name="identity_name" id="xx-input-identity-name-edit">
														<volist name="userindentity" id="vo">
															<option value="{$vo.identity_name}">{$vo.identity_name}</option>
														</volist>
													</select>
												</div>
												<div class="col-sm-4">
													<p class="xx-p-validate-result" attr-validate="hospital_doctor_identity"></p>
												</div>
											</div>
											<div class="form-group">
												<label for="xx-input-hospital-office-id" class="control-label col-sm-3">科室名称：</label>
												<div class="col-sm-5">
													<select class="form-control" name="type" id="xx-select-keshi">
														<volist name="useroffices" id="vo">
															<option value="{$vo.hospital_office_name}">{$vo.hospital_office_name}</option>
														</volist>
													</select>
												</div>
												<div class="col-sm-4">
													<p class="xx-p-validate-result" attr-validate="hospital_office_id"></p>
												</div>
											</div>
											<div class="form-group">
												<label for="xx-input-hospital-doctor-introduction-edit" class="control-label col-sm-3">医生简介：</label>
												<div class="col-sm-5">
													<textarea class="js-editor" id="xx-textarea-hospital-doctor-introduction-edit" name="hospital_doctor_introduction" rows="5" placeholder="请输入内容"></textarea>
												</div>
												<div class="col-sm-4">
													<p class="xx-p-validate-result" attr-validate="hospital_doctor_introduction"></p>
												</div>
											</div>
											<div class="form-group">
												<label for="xx-input-hospital-doctor-phone-edit" class="control-label col-sm-3">联系方式：</label>
												<div class="col-sm-5">
													<input id="xx-input-hospital-doctor-phone-edit" class="form-control" type="text" 
													name="hospital_doctor_phone" placeholder="请输入联系方式" />
												</div>
												<div class="col-sm-4">
													<p class="xx-p-validate-result" attr-validate="hospital_doctor_phone"></p>
												</div>
											</div>
											<div class="form-group">
												<label for="xx-input-image" class="control-label col-sm-3">医生照片：</label>
												<div class="col-sm-5">
													<input id="xx-input-img2-uploader" type="file" />
													<!-- 展示缩略图 -->
													<img src="" alt="" id="xx-img-show-thumb" width="150px" style="display: none;"/>
													<!-- 封面图字段 -->
													<input type="hidden" name="image_path" id="xx-input-image-path"/>
													<!-- 缩略图图字段 -->
													<input type="hidden" name="thumb_path" id="xx-input-thumb-path"/>
												</div>
											</div>
											<div class="form-group">
												<label for="" class="control-label col-sm-3">性别：</label>
												<div class="col-sm-5">
													<input type="radio" name="hospital_doctor_sex" id="man" value="男" />男
													<input type="radio" name="hospital_doctor_sex" id="woman" value="女" />女
												</div>
											</div>
											<div class="form-group">
												<label for="" class="control-label col-sm-3">状态：</label>
												<div class="col-sm-5">
													<input type="radio" name="status" value="1" checked="" />开启
													<input type="radio" name="status" value="0" />关闭
												</div>
											</div>
										</form>
									</div>
								</div><!--.row表单-->
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-default" data-dismiss="modal">
									关闭
								</button>
								<button type="button" class="btn btn-primary" id="xx-btn-add-submit" onclick="update()">
									提交更改
								</button>
							</div>
						</div><!-- /.modal-content -->
					</div><!-- /.modal -->
				</div>
			</div>
		</div>
	</div>
</div>

	<script>
		var SCOPE = {
			'add_url':'__URL__/add',
			'save_url':'__URL__/save',
			'success_jump_url':'__URL__/index',
			'set_status_url':'__URL__/setStatus',
			'ajax_upload_swf':'__JS__/vendor/uploadify/uploadify.swf',
			'ajax_upload_url':'__URL__/ajaxUploadImage',
		};
		$('#element1').popover('show')
		//向模态框传值
		function editClick(obj){
//			console.log(obj.parentNode.parentNode);
			var objpp = obj.parentNode.parentNode;
			var msg = [];
//			console.log(objpp.children);
//			console.log(objpp.children.length);
			for (var i=0 ; i<objpp.children.length;i++){
//				console.log(objpp.children[i].innerText)
				msg[i] = objpp.children[i].innerText;
			}
			console.log(msg);
			$('#xx-input-doctorid').val(msg[0]);
			$('#xx-input-hospital-doctor-name-edit').val(msg[1]);
			$('#xx-input-identity-name-edit').val(msg[4]);
			$('#xx-select-keshi').val(msg[3]);
			$('#xx-textarea-hospital-doctor-introduction-edit').val(msg[5]);
			$('#xx-input-hospital-doctor-phone-edit').val(msg[6]);
			$('#xx-img-show-thumb').val(msg[2]);
			$('#xx-input-hospital-office-id-edit').val(msg[7]);
			$('#xx-input-hospital-doctor-identity-edit').val(msg[8]);
			if (msg[7] == '女') {  
       			$('#woman').attr('checked','true');  
   			} else {  
      			$('#man').attr('checked','true');   
 			}  
			$('#Modal').modal();
		}
		//从模态框取值,编辑医生信息
		function update() {  
		    //获取模态框数据 
		    var postData = {};
		    postData['hospital_doctor_id'] = $('#xx-input-doctorid').val();
		    postData['hospital_doctor_name'] = $('#xx-input-hospital-doctor-name-edit').val();
			postData['identity_name'] = $('#xx-input-identity-name-edit').val();
			postData['hospital_office_name'] = $('#xx-select-keshi').val();
			postData['hospital_doctor_introduction'] = $('#xx-textarea-hospital-doctor-introduction-edit').val();
			postData['hospital_doctor_phone'] = $('#xx-input-hospital-doctor-phone-edit').val();
			postData['community_hospitals_id'] = $('#xx-input-hospital-office-id-edit').val();
			postData['hospital_doctor_identity'] = $('#xx-input-hospital-doctor-identity-edit').val();
			postData['hospital_doctor_sex'] = $('input:radio[name="hospital_doctor_sex"]:checked').val();
			console.log(postData);
		    $.ajax({
		        type: 'post',  
		        url: SCOPE.add_url,  
		        data: postData,
		        dataType: 'json',  
		        success: function(result) {  
		            //location.reload();
		            if(result.status == SUCCESS){
						//成功
						return Dialog.success(result.msg,SCOPE.success_jump_url);
					}else if(result.status == VALIDATE_ERROR){
						//表单验证出错
						var errors = result.msg;
						//把input对应name下的错误信息取出来，添加到input后面
						$('.xx-p-validate-result').each(function(){
							var errorMsg = errors[$(this).attr('attr-validate')];
							$(this).html(errorMsg != undefined ? '*'+errorMsg : '').css({color:'red'});
						});
					}else{
	 					return Dialog.error(result.msg);
					}
			    }  
		    });
		}
	</script>
		
<include file="Index/footer" />