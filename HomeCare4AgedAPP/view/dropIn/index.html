<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/common/common.css" />
		<link rel="stylesheet" href="../../css/dropIn/index.css" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav m_green2DropIn">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<a id="btn-history" class=" mui-icon  mui-pull-right" style="font-size: 30px;margin-left: -3%;margin-top: 15px;">订单</a>
			<h1 class="mui-title">上门</h1>
			<ul id="zz-div-address" class="mui-bar top60px " style="height: 90px;">
				<h5 class="grayText mui-navigate-right" id="zz-h5-address" style="font-weight: bold; font-size: 30px; float: left; margin-left: 15px; padding-top: 1%;padding-bottom: 6%;width: 85%; line-height: 30px; margin-right: 0px;"></h5>
			</ul>
		</header>
		<ul class="mui-table-view" id="list_ul">
			<!--<li id="g-li" class="mui-table-view-cell mui-media">
				<div class="marginLeftRight">
					<h1 class="blackTitle">家政清洁</h1>
					<h3 class="grayText">17个服务</h3>
				</div>
			</li>-->
		</ul>
		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/constants.js"></script>
		<script type="text/javascript" src="../../js/jquery.1.11.1.js"></script>
		<script type="text/javascript">
			mui.init({
				swipeBack: true, //启用右滑关闭功能
				beforeback: function() {
					//获得你要前往页面的webview id
					var Scanner = plus.webview.getWebviewById(plus.webview.currentWebview().webId);
					//触发前往页面的自定义事件（例：AddNew）,从而进行数据刷新
					mui.fire(Scanner, 'refreshWeather');
					//返回true，继续页面关闭逻辑
					return true;
				},
			});

			mui.plusReady(function() {
				document.getElementById('btn-history').addEventListener('tap',function () {
					localStorage.fromUserInfo = 'no';
					mui.openWindow({
						url: '../dropIn/myHistory.html',
					});
				});
				var nwaiting = plus.nativeUI.showWaiting();
				plus.navigator.setStatusBarBackground('#30B69C');

				document.getElementById('zz-h5-address').innerHTML = '送至：' + localStorage.community_user_address;
				var ulHeight = document.getElementById("zz-h5-address");
				document.getElementById("zz-div-address").setAttribute("style", "height:" + ulHeight.offsetHeight + "px;")
					//				document.getElementById("zz-h5-go").style.marginTop = "-"+document.getElementById("zz-div-address").offsetHeight/1.5+"px";
				console.log(document.getElementById("zz-div-address").offsetHeight);
				var ulMarginTop = document.getElementById("zz-div-address").offsetHeight + 60;
				document.getElementById("list_ul").setAttribute("style", "margin-top:" + ulMarginTop + "px;");
				var postData = {};
				postData['lat'] = localStorage.community_user_lat;
				postData['lng'] = localStorage.community_user_lng;
				console.log(JSON.stringify(postData));
				mui.ajax({
					type: 'POST',
					data: postData,
					url: SERVERURL + 'SStoreServiceClassify/getServiceClassifyList',
					dataType: "json",
					timeout:20000,
					//成功获取数据赋值
					success: function(data) {
						console.log(JSON.stringify(data));
						plus.nativeUI.closeWaiting();
						var doc = document;
						fragment = doc.createDocumentFragment();
						container = doc.getElementById("list_ul");
						mui.each(data.data, function(i) {
							var doc = document;
							li = doc.createElement("li");
							div = doc.createElement('div');
							h1 = doc.createElement('h1');
							h3 = doc.createElement('h3');
							li.setAttribute("class", "mui-table-view-cell mui-media");
							div.setAttribute("class","marginLeftRight");
							h1.setAttribute("class","blackTitle");
							h1.innerHTML = data.data[i].type;
							h3.setAttribute("class","grayText");
							h3.innerHTML = data.data[i].count+'个服务';
							li.id = data.data[i].type;
							
							
							li.addEventListener('tap', function() {
								localStorage.service_classify_name = this.id;
								console.log('====='+this.id);
								mui.openWindow({
									url: '../dropIn/serviceList.html',
								});
							});
							li.appendChild(div);
							div.appendChild(h1);
							div.appendChild(h3);
							fragment.appendChild(li);
						});
						container.appendChild(fragment);
					},
					error: function(xhr, type, errorThrown) {
						console.log(type);
						plus.nativeUI.closeWaiting();
						mui.alert('网络连接失败');
					}
				});
			});
		</script>
	</body>

</html>